zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: 26f42bba0c4448c290fa5423bb4a2664
      name: 'Custom Templates'
  templates:
    - uuid: f040f5808202478aaa3fa1894eb69d4f
      template: LibreHardwareMonitor
      name: LibreHardwareMonitor
      description: |
        Use this template along Libre Hardware Monitor. Download from https://github.com/LibreHardwareMonitor/LibreHardwareMonitor
        
        Modify macros {$LIBREHARDWAREMONITOR.URL} and {$TEMPSCALE} (just to match your temperature scale)
        
        Please report issues or contribute on GitHub: https://github.com/zingaya/zbx_hardware_monitor
      groups:
        - name: 'Custom Templates'
      items:
        - uuid: 4d0c771bb64c4b949a10b4ffdf1bf1ea
          name: 'Get LibreHardwareMonitor raw data'
          type: HTTP_AGENT
          key: lhm.get.json
          delay: 0;m/1
          history: '0'
          value_type: TEXT
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.Children[*].Children[*]'
            - type: STR_REPLACE
              parameters:
                - '"ImageURL":"images_icon/'
                - '"Type":"'
            - type: STR_REPLACE
              parameters:
                - '.png"'
                - '"'
          url: '{$LIBREHARDWAREMONITOR.URL}'
          tags:
            - tag: component
              value: raw
      discovery_rules:
        - uuid: 9877f06ae582437091db79e96d49a9e5
          name: 'Discover component sensors - {#COMPONENTNAME}'
          type: NESTED
          key: 'lhm.discover.component.sensors[{#COMPONENTNAME}]'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#SENSORID}'
                operator: EXISTS
              - macro: '{#SENSORTYPE}'
                value: ^(Temperature|Power)$
          item_prototypes:
            - uuid: 4bb26ad12a574644a82e788266d130b4
              name: '{{#COMPONENTTYPE}.uppercase()} power - {#SENSORNAME}'
              type: DEPENDENT
              key: 'lhm.sensor.power[{#SENSORID} {#ID}]'
              history: 2w
              value_type: FLOAT
              trends: '0'
              discover: NO_DISCOVER
              units: W
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$..Children[?(@.SensorId == "{#SENSORID}")].Value.first()'
                - type: STR_REPLACE
                  parameters:
                    - ','
                    - .
                - type: REGEX
                  parameters:
                    - '([0-9.]+)'
                    - \1
              master_item:
                key: lhm.get.json
              tags:
                - tag: component
                  value: 'lhm-{{#SENSORTYPE}.lowercase()}'
            - uuid: c2916918689245d6b5d6c0ff5a084fc5
              name: '{{#COMPONENTTYPE}.uppercase()} temperature - {#SENSORNAME} (ยบ{$TEMPSCALE})'
              type: DEPENDENT
              key: 'lhm.sensor.temperature[{#SENSORID} {#ID}]'
              history: 2w
              value_type: FLOAT
              trends: '0'
              discover: NO_DISCOVER
              units: ยบ
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$..Children[?(@.SensorId == "{#SENSORID}")].Value.first()'
                - type: STR_REPLACE
                  parameters:
                    - ','
                    - .
                - type: REGEX
                  parameters:
                    - '([0-9.]+)'
                    - \1
              master_item:
                key: lhm.get.json
              tags:
                - tag: component
                  value: 'lhm-{{#SENSORTYPE}.lowercase()}'
          parent_discovery_rule:
            key: lhm.discover.components
          lld_macro_paths:
            - lld_macro: '{#ID2}'
              path: $.id
            - lld_macro: '{#SENSORID}'
              path: $.SensorId
            - lld_macro: '{#SENSORNAME}'
              path: $.Text
            - lld_macro: '{#SENSORTYPE}'
              path: $.Type
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$..Children[*].Children[*]'
          overrides:
            - name: Power
              step: '1'
              stop: STOP
              filter:
                conditions:
                  - macro: '{#SENSORTYPE}'
                    value: Power
              operations:
                - operator: REGEXP
                  value: 'power -'
                  discover: DISCOVER
            - name: Temperature
              step: '2'
              stop: STOP
              filter:
                conditions:
                  - macro: '{#SENSORTYPE}'
                    value: Temperature
              operations:
                - operator: REGEXP
                  value: 'temperature -'
                  discover: DISCOVER
        - uuid: 753ddd98358d4ecfa7081a5fc7414212
          name: 'Discover components'
          type: DEPENDENT
          key: lhm.discover.components
          filter:
            conditions:
              - macro: '{#COMPONENTTYPE}'
                value: cpu|ati|nvidia|gpu|ram|mainboard
          master_item:
            key: lhm.get.json
          lld_macro_paths:
            - lld_macro: '{#COMPONENTNAME}'
              path: $.Text
            - lld_macro: '{#COMPONENTTYPE}'
              path: $.Type
            - lld_macro: '{#ID}'
              path: $.id
      macros:
        - macro: '{$LIBREHARDWAREMONITOR.URL}'
          value: 'http://IP:8085/data.json'
        - macro: '{$TEMPSCALE}'
          value: C
          description: 'C - Celsius | F - Farenheit'
