zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: 26f42bba0c4448c290fa5423bb4a2664
      name: 'Custom Templates'
  templates:
    - uuid: f040f5808202478aaa3fa1894eb69d4f
      template: LibreHardwareMonitor
      name: LibreHardwareMonitor
      description: |
        This template allows you to monitor hardware sensors like temperature, power, load, fans and even more, on a Windows machine.
        It is needed to download official Libre Hardware Monitor https://github.com/LibreHardwareMonitor/LibreHardwareMonitor
        Setup the web interface on the Libre Hardware Monitor, and don't forget allow it in Windows firewall. Recommended setup to start at boot.
        
        The current items in Zabbix will get a Json, and use LLD for the power and temperature sensors. You can create your own LLD to expand to your needs.
        Change the item prototypes for temperatures, and adjust the "Units" for Celsius (default) or Fahrenheit.
        
        Tested in:
        Zabbix 7.0.0alpha9
        ASUS TUF GAMING X670E-PLUS WIFI
        Nvidia RTX 4070Ti
        Ryzen 7600x
        Windows 10
        
        Please report issues or contribute on GitHub: https://github.com/zingaya/zbx_hardware_monitor
      groups:
        - name: 'Custom Templates'
      items:
        - uuid: 4d0c771bb64c4b949a10b4ffdf1bf1ea
          name: 'Get LibreHardwareMonitor raw data'
          type: HTTP_AGENT
          key: lhm.get.json
          delay: 0;m/1
          history: '0'
          value_type: TEXT
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.Children[*].Children[*]'
            - type: STR_REPLACE
              parameters:
                - '"ImageURL":"images_icon/'
                - '"Type":"'
            - type: STR_REPLACE
              parameters:
                - '.png"'
                - '"'
          url: '{$LIBREHARDWAREMONITOR.URL}'
          tags:
            - tag: component
              value: lhm-raw
      discovery_rules:
        - uuid: 9877f06ae582437091db79e96d49a9e5
          name: 'Discover component sensors - {#COMPONENTNAME}'
          type: NESTED
          key: 'lhm.discover.component.sensors[{#COMPONENTNAME}]'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#SENSORID}'
                operator: EXISTS
              - macro: '{#SENSORTYPE}'
                value: ^(Temperature|Power)$
          item_prototypes:
            - uuid: 4bb26ad12a574644a82e788266d130b4
              name: '{{#COMPONENTTYPE}.uppercase()} power - {#SENSORNAME}'
              type: DEPENDENT
              key: 'lhm.sensor.power[{#SENSORID} {#ID}]'
              history: 2w
              value_type: FLOAT
              trends: '0'
              discover: NO_DISCOVER
              units: W
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$..Children[?(@.SensorId == "{#SENSORID}")].Value.first()'
                - type: STR_REPLACE
                  parameters:
                    - ','
                    - .
                - type: REGEX
                  parameters:
                    - '([0-9.]+)'
                    - \1
              master_item:
                key: lhm.get.json
              tags:
                - tag: component
                  value: 'lhm-{{#SENSORTYPE}.lowercase()}'
            - uuid: c2916918689245d6b5d6c0ff5a084fc5
              name: '{{#COMPONENTTYPE}.uppercase()} temperature - {#SENSORNAME} (ยบ{$TEMPTYPE})'
              type: DEPENDENT
              key: 'lhm.sensor.temperature[{#SENSORID} {#ID}]'
              history: 2w
              value_type: FLOAT
              trends: '0'
              discover: NO_DISCOVER
              units: ยบ
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$..Children[?(@.SensorId == "{#SENSORID}")].Value.first()'
                - type: STR_REPLACE
                  parameters:
                    - ','
                    - .
                - type: REGEX
                  parameters:
                    - '([0-9.]+)'
                    - \1
              master_item:
                key: lhm.get.json
              tags:
                - tag: component
                  value: 'lhm-{{#SENSORTYPE}.lowercase()}'
          parent_discovery_rule:
            key: lhm.discover.components
          lld_macro_paths:
            - lld_macro: '{#ID2}'
              path: $.id
            - lld_macro: '{#SENSORID}'
              path: $.SensorId
            - lld_macro: '{#SENSORNAME}'
              path: $.Text
            - lld_macro: '{#SENSORTYPE}'
              path: $.Type
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$..Children[*].Children[*]'
          overrides:
            - name: Power
              step: '1'
              stop: STOP
              filter:
                conditions:
                  - macro: '{#SENSORTYPE}'
                    value: Power
              operations:
                - operator: REGEXP
                  value: 'power -'
                  discover: DISCOVER
            - name: Temperature
              step: '2'
              stop: STOP
              filter:
                conditions:
                  - macro: '{#SENSORTYPE}'
                    value: Temperature
              operations:
                - operator: REGEXP
                  value: 'temperature -'
                  discover: DISCOVER
        - uuid: 753ddd98358d4ecfa7081a5fc7414212
          name: 'Discover components'
          type: DEPENDENT
          key: lhm.discover.components
          filter:
            conditions:
              - macro: '{#COMPONENTTYPE}'
                value: cpu|ati|nvidia|gpu|ram|mainboard
          master_item:
            key: lhm.get.json
          lld_macro_paths:
            - lld_macro: '{#COMPONENTNAME}'
              path: $.Text
            - lld_macro: '{#COMPONENTTYPE}'
              path: $.Type
            - lld_macro: '{#ID}'
              path: $.id
      macros:
        - macro: '{$LIBREHARDWAREMONITOR.URL}'
          value: 'http://IP:8085/data.json'
        - macro: '{$TEMPTYPE}'
          value: C
          description: 'C - Celsius | F - Farenheit'
      dashboards:
        - uuid: 6f807a24b0e74eb3a6a4390c1a642148
          name: Sensors
          pages:
            - widgets:
                - type: graphprototype
                  width: '48'
                  height: '5'
                  fields:
                    - type: STRING
                      name: reference
                      value: WIBUJ
                - type: graphprototype
                  'y': '5'
                  width: '48'
                  height: '5'
                  fields:
                    - type: STRING
                      name: reference
                      value: POQRA
